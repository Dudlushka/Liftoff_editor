<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OFFBlast! Liftoff track editor [Dudlushka]</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- <link rel="stylesheet" href="style_dark.css" />  -->
    <link rel="stylesheet" href="style_light.css" />
  </head>
  <body>
    <div id="app">
<header>
  <div class="header-top">
    <h1>OFFBlast! (unofficial) track editor – (with THREE.js) </h1>
    <nav class="header-links">
      <a href="help.html" target="_blank" rel="noopener noreferrer">Help</a>
      <a href="picgen.html" target="_blank" rel="noopener noreferrer">PicGen</a>
    </nav>
  </div>
  <div class="hint">
    Middle: pan · Right: 3D orbit · Wheel: zoom · PageUp/Down: camera
    up/down · Left: move (XZ) · Shift+Left: up/down · Alt+Left: rotate ·
    Ctrl+Left: select (multi)
  </div>
</header>

      <aside>
        <fieldset>
          <legend>Mode</legend>
          <select id="mode">
            <option value="gp">GamePrimitive Editor</option>
            <option value="grp">Group Editor</option>
            <option value="scn">Scene Editor</option>
          </select>
        </fieldset>

        <fieldset>
          <legend>Edit</legend>
          <div class="btn-wrap">
            <button class="btn" id="undoBtn">Undo (Ctrl+Z)</button>
            <button class="btn" id="redoBtn">Redo (Ctrl+Y)</button>
            <button class="btn" id="copyBtn">Copy</button>
            <button class="btn" id="pasteBtn">Paste</button>
            <button class="btn" id="dupBtn">Duplicate</button>
            <button class="btn" id="toggleVisBtn">Show/Hide</button>
            <button class="btn" id="deleteBtn">Delete (Del)</button>
          </div>
          <div class="note">
            Multi-select: Ctrl+click in the list OR on the canvas. Drag always
            moves the item(s) selected in the list.
          </div>
        </fieldset>

        <fieldset>
          <legend>Grid & Track</legend>
          <div class="row">
            <div>
              <label>Minor (1 unit)</label>
              <input id="minorColor" type="color" value="#cccccc" />
            </div>
            <div>
              <label>Major (10 units)</label>
              <input id="majorColor" type="color" value="#888888" />
            </div>
            <div>
              <label>BG (10 units)</label>
              <input id="BGColor" type="color" value="#f0f0f0" />
            </div>
            <div>
              <label>Grid size (±)</label>
              <input id="gridSize" type="number" value="200" step="10" />
            </div>
          </div>
          <div class="row2">
            <div>
              <label>Group bounding boxes</label>
              <select id="groupBoundsVis">
                <option value="off">Off</option>
                <option value="on" selected>On</option>
              </select>
            </div>
            <div>
              <label>Game ver.</label>
              <input id="gameVersion" type="text" value="1.6.17" />
            </div>
          </div>
          
          <div class="row2">
            <div>
              <label>Track name</label>
              <input id="trackName" type="text" value="New track" />
            </div>
            <div>
              <label>Track UUID</label>
              <input
                id="trackUUID"
                type="text"
                value="00000000-0000-0000-0000-000000000000"
              />
            </div>
          </div>

          <div class="row2">
            <div>
              <label>Environment</label>
              <input id="trackEnvironment" type="text" value="TheDrawingBoard" />
            </div>

          </div>



        </fieldset>

        <fieldset id="gpPane">
          <legend>GamePrimitive editor</legend>
          <label>Name</label>
          <input
            id="gpName"
            type="text"
            placeholder="e.g. DrawingBoardCube0.5mx0.5m04"
          />

          <label>
           <input type="checkbox" id="gpScalable">
           Scalable
          </label>

          <div class="btn-wrap">
            <button class="btn" id="gpNew">New</button>
            <button class="btn" id="gpSave">Save/Update</button>
            <button class="btn" id="gpDelete">Delete</button>
          </div>

          <label class="smalllabel">Existing GamePrimitives</label>
          <ul class="list" id="gpList"></ul>

          <legend>Parts</legend>
          <div class="inline-row">
            <select id="partType">
              <option value="box">Box</option>
              <option value="cylinder">Cylinder</option>
              <option value="sphere">Sphere</option>
              <option value="cone">Cone</option>
              <option value="quarterTorus">QuarterTorus</option>
              <option value="arcCyl">ArcCyl (sidewall)</option>
              <option value="pyramid">Pyramid</option>
              <option value="hemisphere">Hemisphere</option>
              <option value="isoTriPrism">Triangle</option>
              <option value="rightTriPrism">Right triangle prism (half box)</option>
            </select>
            <button class="btn" id="addPart">+ Add</button>
            <button class="btn" id="removePart">– Remove</button>
          </div>
          <ul class="list" id="partList"></ul>

          <fieldset>
            <legend>Selected part(s) settings</legend>
            <div class="row">
              <div>
                <label>Color</label>
                <input id="pColor" type="color" value="#bdbdbd" />
              </div>
              <div>
                <label>Type</label>
                <input id="pTypeRO" type="text" disabled />
              </div>
              <div>
                <label>Rotation axis</label>
                <select id="pRotAxis">
                  <option value="X">X (roll)</option>
                  <option value="Y" selected>Y (yaw)</option>
                  <option value="Z">Z (pitch)</option>
                </select>
              </div>
            </div>
            <div id="pArcBox" class="row" style="display: none">
              <div>
                <label>Inner radius (innerR)</label>
                <input id="pInnerR" type="number" step="0.05" value="0.3" />
              </div>
              <div>
                <label>Outer radius (outerR)</label>
                <input id="pOuterR" type="number" step="0.05" value="0.5" />
              </div>
              <div>
                <label>Angle (°)</label>
                <input id="pAngle" type="number" step="1" value="90" />
              </div>
            </div>
            <div class="row4">
              <div>
                <label>Pos X</label
                ><input id="pPosX" type="number" step="0.1" value="0" />
              </div>
              <div>
                <label>Pos Y</label
                ><input id="pPosY" type="number" step="0.1" value="0" />
              </div>
              <div>
                <label>Pos Z</label
                ><input id="pPosZ" type="number" step="0.1" value="0" />
              </div>
              <div class="align-bottom">
                <button class="btn" id="applyPart">Apply</button>
              </div>
            </div>
            <div class="row">
              <div>
                <label>Roll (X°)</label
                ><input id="pRoll" type="number" step="1" value="0" />
              </div>
              <div>
                <label>Yaw (Y°)</label
                ><input id="pYaw" type="number" step="1" value="0" />
              </div>
              <div>
                <label>Pitch (Z°)</label
                ><input id="pPitch" type="number" step="1" value="0" />
              </div>
            </div>

            <div class="row">
              <div>
                <label>Scale X</label
                ><input id="pSx" type="number" step="0.1" value="1" />
              </div>
              <div>
                <label>Scale Y</label
                ><input id="pSy" type="number" step="0.1" value="1" />
              </div>
              <div>
                <label>Scale Z</label
                ><input id="pSz" type="number" step="0.1" value="1" />
              </div>
            </div>



          </fieldset>
        </fieldset>

        <fieldset id="grpPane" style="display: none">
          <legend>Group editor</legend>
          <label>Name</label>
          <input id="grpName" type="text" placeholder="e.g. WallModule_A" />
          <div class="btn-wrap">
            <button class="btn" id="grpNew">New</button>
            <button class="btn" id="grpSave">Save/Update</button>
            <button class="btn" id="grpDelete">Delete</button>
          </div>
          <label class="smalllabel">Existing Groups</label>
          <ul class="list" id="grpList"></ul>

          <legend>Components</legend>

          <label class="smalllabel" for="grpFilter">
            Filter components (contains)
          </label>
          <input
            id="grpFilter"
            type="text"
            placeholder="Type to filter Group sources..."
          />




          <div class="inline-row">
            <select id="grpAddType">
              <option value="gp">GamePrimitive</option>
              <option value="grp">Group</option>
            </select>
            <select id="grpAddSource"></select>
            <button class="btn" id="grpAdd">+ Add</button>
            <button class="btn" id="grpRemove">– Remove</button>
          </div>
          <ul class="list" id="grpItemList"></ul>

          <fieldset>
            <legend>Selected item(s) transform</legend>
            <div class="row">
              <div>
                <label>Rotation axis</label>
                <select id="gRotAxis">
                  <option value="X">X (roll)</option>
                  <option value="Y" selected>Y (yaw)</option>
                  <option value="Z">Z (pitch)</option>
                </select>
              </div>
            </div>
            <div class="row4">
              <div>
                <label>Pos X</label
                ><input id="gPosX" type="number" step="0.1" value="0" />
              </div>
              <div>
                <label>Pos Y</label
                ><input id="gPosY" type="number" step="0.1" value="0" />
              </div>
              <div>
                <label>Pos Z</label
                ><input id="gPosZ" type="number" step="0.1" value="0" />
              </div>
              <div class="align-bottom">
                <button class="btn" id="applyGrpItem">Apply</button>
              </div>
            </div>
            <div class="row">
              <div>
                <label>Roll (X°)</label
                ><input id="gRoll" type="number" step="1" value="0" />
              </div>
              <div>
                <label>Yaw (Y°)</label
                ><input id="gYaw" type="number" step="1" value="0" />
              </div>
              <div>
                <label>Pitch (Z°)</label
                ><input id="gPitch" type="number" step="1" value="0" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Scale X</label
                ><input id="gSx" type="number" step="0.1" value="1" />
              </div>
              <div>
                <label>Scale Y</label
                ><input id="gSy" type="number" step="0.1" value="1" />
              </div>
              <div>
                <label>Scale Z</label
                ><input id="gSz" type="number" step="0.1" value="1" />
              </div>
            </div>
          </fieldset>
        </fieldset>

        <fieldset id="scnPane" style="display: none">
          <legend>Scene editor</legend>

          <label class="smalllabel" for="scnFilter">
            Filter sources (contains)
            </label>
            <input
              id="scnFilter"
              type="text"
              placeholder="Type to filter Scene sources..."
            />

          <div class="inline-row">
            <select id="scnAddType">
              <option value="gp">GamePrimitive</option>
              <option value="grp">Group</option>
            </select>
            <select id="scnAddSource"></select>
            <button class="btn" id="scnAdd">+ Add</button>
            <button class="btn" id="scnRemove">– Remove</button>
          </div>
          <ul class="list" id="scnList"></ul>

          <fieldset>
            <legend>Selected scene item(s) transform</legend>
            <div class="row">
              <div>
                <label>Rotation axis</label>
                <select id="sRotAxis">
                  <option value="X">X (roll)</option>
                  <option value="Y" selected>Y (yaw)</option>
                  <option value="Z">Z (pitch)</option>
                </select>
              </div>
            </div>
            <div class="row4">
              <div>
                <label>Pos X</label
                ><input id="sPosX" type="number" step="0.1" value="0" />
              </div>
              <div>
                <label>Pos Y</label
                ><input id="sPosY" type="number" step="0.1" value="0" />
              </div>
              <div>
                <label>Pos Z</label
                ><input id="sPosZ" type="number" step="0.1" value="0" />
              </div>
              <div class="align-bottom">
                <button class="btn" id="applySceneItem">Apply</button>
              </div>
            </div>
            <div class="row">
              <div>
                <label>Roll (X°)</label
                ><input id="sRoll" type="number" step="1" value="0" />
              </div>
              <div>
                <label>Yaw (Y°)</label
                ><input id="sYaw" type="number" step="1" value="0" />
              </div>
              <div>
                <label>Pitch (Z°)</label
                ><input id="sPitch" type="number" step="1" value="0" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Scale X</label
                ><input id="sSx" type="number" step="0.1" value="1" />
              </div>
              <div>
                <label>Scale Y</label
                ><input id="sSy" type="number" step="0.1" value="1" />
              </div>
              <div>
                <label>Scale Z</label
                ><input id="sSz" type="number" step="0.1" value="1" />
              </div>
            </div>
          </fieldset>

          <fieldset>
            <legend>Rotation – Euler</legend>

            <label for="eulerOrder">Euler order</label>
            <select id="eulerOrder">
              <option value="XYZ">XYZ</option>
              <option value="XZY">XZY</option>
              <option value="YXZ">YXZ</option>
              <option value="YZX">YZX</option>
              <option value="ZXY">ZXY</option>
              <option value="ZYX">ZYX</option>
            </select>

            <div class="note" style="margin-top:6px">
              Game-space (display only): 
              R=<span id="gameR">0</span>°, 
              Y=<span id="gameY">0</span>°, 
              P=<span id="gameP">0</span>°
            </div>
          </fieldset>

          <!-- === Control Lines (Scene editor extension) === -->
<section id="clPane" style="display: block">
  <h3>Control Lines</h3>

  <label>
    Drawing mode
    <input id="clDrawMode" type="number" step="1" min="0" max="3" value="0" />
  </label>

  <div class="row">
    <!-- Left: ControlLine list and actions -->
    <fieldset class="column">
      <legend>Lines</legend>

      <ul id="clList" class="list"></ul>
      <div class="btnrow">
        <button id="clNew">New</button>
        <button id="clSave">Save</button>
        <button id="clDelete">Delete</button>
      </div>

      <label>
        Name
        <input id="clName" type="text" placeholder="CL name" />
      </label>

      <div class="grid2">
        <label>
          Radius
          <input id="clRadius" type="number" step="0.01" value="0.8" />
        </label>
        <label title="0: none · 1: path only · 2: path+Major · 3: path+Major+Minor">
          Style
          <input id="clStyle" type="number" step="1" min="0" max="3" value="0" />
        </label>
        <label>
          Start offset
          <input id="clStartOffset" type="number" step="0.01" value="0" />
        </label>
        <label>
          dL
          <input id="clDL" type="number" step="0.01" value="1.0" />
        </label>
      </div>

      <!-- CP / Line objects with lists -->
      <label>
        CP objects
        <div class="inline-row">
          <select id="clCPRefType">
            <option value="null">null</option>
            <option value="gp">GamePrimitive</option>
            <option value="grp">Group</option>
          </select>
          <select id="clCPRefName">
            <option value="null">null</option>
          </select>
          <button class="btn" id="clCPRefAdd">+ Add</button>
        </div>
        <ul id="clCPRefList" class="list"></ul>
      </label>

      <label>
        Line objects
        <div class="inline-row">
          <select id="clLineRefType">
            <option value="null">null</option>
            <option value="gp">GamePrimitive</option>
            <option value="grp">Group</option>
          </select>
          <select id="clLineRefName">
            <option value="null">null</option>
          </select>
          <button class="btn" id="clLineRefAdd">+ Add</button>
        </div>
        <ul id="clLineRefList" class="list"></ul>
      </label>

      <!-- Supports -->
      <fieldset>
        <legend>Supports</legend>

        <label>
          Major objects
          <div class="inline-row">
            <select id="clSupportMajorRefType">
              <option value="null">null</option>
              <option value="gp">GamePrimitive</option>
              <option value="grp">Group</option>
            </select>
            <select id="clSupportMajorRefName">
              <option value="null">null</option>
            </select>
            <button class="btn" id="clSupportMajorRefAdd">+ Add</button>
          </div>
          <ul id="clSupportMajorRefList" class="list"></ul>
        </label>

        <label>
          Minor objects
          <div class="inline-row">
            <select id="clSupportMinorRefType">
              <option value="null">null</option>
              <option value="gp">GamePrimitive</option>
              <option value="grp">Group</option>
            </select>
            <select id="clSupportMinorRefName">
              <option value="null">null</option>
            </select>
            <button class="btn" id="clSupportMinorRefAdd">+ Add</button>
          </div>
          <ul id="clSupportMinorRefList" class="list"></ul>
        </label>

        <div class="grid2">
          <label>
            Major height (m)
            <input id="clSupportMajorH" type="number" step="0.01" min="0" value="3.0" />
          </label>
          <label>
            Minor height (m)
            <input id="clSupportMinorH" type="number" step="0.01" min="0" value="1.0" />
          </label>
          <label title="Thinning: 1 = every AUX; 2 = every 2nd; etc.">
            Decimate (N)
            <input id="clSupportDecimate" type="number" step="1" min="1" value="1" />
          </label>
          <label title="Decimate phase offset (can be negative)">
            Decimate offset
            <input id="clSupportDecimateOffset" type="number" step="1" value="0" />
          </label>
          <label title="Top offset (m) – can be negative">
            Top offset (m)
            <input id="clSupportTopOffset" type="number" step="0.01" value="0" />
          </label>
          <label title="Bottom offset (m) – can be negative">
            Bottom offset (m)
            <input id="clSupportBottomOffset" type="number" step="0.01" value="0" />
          </label>
        </div>

        <div class="checkrow">
          <label><input id="clSupportRotate" type="checkbox" /> Rot(Y)</label>
        </div>
      </fieldset>

      <div class="checkrow">
        <label><input id="clShowAux" type="checkbox" checked /> AuxPoints</label>
        <label><input id="clShowRadius" type="checkbox" checked /> ShowRad</label>
      </div>

      <button id="clGenerate" class="btn primary">Generate</button>
    </fieldset>

    <!-- Right: ControlPoint list and editing -->
    <fieldset class="column">
      <legend>Control Points</legend>

      <ul id="cpList" class="list"></ul>
      <div class="btnrow">
        <button id="cpAdd">+ Point</button>
        <button id="cpRemove">– Point</button>
      </div>

      <div class="grid3">
        <label title="0: no gate · 1: has gate">
          Style
          <input id="cpStyle" type="number" step="1" min="0" max="1" value="1" />
        </label>
        <label title="0: none · 1: path · 2: path+Major · 3: path+Major+Minor (for the next segment)">
          LineStyle
          <input id="cpLineStyle" type="number" step="1" min="0" max="3" value="1" />
        </label>
        <span></span>

        <label>
          in-weight (iw)
          <input id="cpIW" type="number" step="0.01" min="0" value="0.5" />
        </label>
        <label>
          out-weight (ow)
          <input id="cpOW" type="number" step="0.01" min="0" value="0.5" />
        </label>
        <span></span>
      </div>

      <div class="note">
        Position and rotation: Scene panel (sPosX/Y/Z, sRoll/Yaw/Pitch), when a CP is selected.
      </div>

      <div class="btnrow">
        <button id="cpApply">Apply</button>
      </div>
    </fieldset>
  </div>
</section>



          
        </fieldset>

        <fieldset>
          <legend>Save/Load</legend>
          <div class="btn-wrap">
            <!--<button class="btn" id="exportXML">Scene → XML (flatten)</button>-->
            <button class="btn" id="saveJSON">Save library</button>
            <label class="btn" for="loadJSON">Load library</label>
            <input
              id="loadJSON"
              type="file"
              accept="application/json"
              style="display: none"
            />
          </div>
          
          <div class="btn-wrap">
            <button class="btn" id="saveSceneJSON">Save scene</button>
            <label class="btn" for="loadSceneJSON">Load scene</label>
            <input
              id="loadSceneJSON"
              type="file"
              accept="application/json"
              style="display: none"
            />
          </div>

          <div class="btn-wrap">
            <button class="btn" id="exportGameXML">Export game XML</button>
            <label class="btn" for="importGameXML">Import game XML</label>
            <input
              id="importGameXML"
              type="file"
              accept=".track,.xml,text/xml,application/xml"
              style="display: none"
              />
          </div>
          <div class="note">
            The game format is Track/Blueprints XML. Groups are flattened
            during export.
          </div>
        </fieldset>

        <fieldset>
          <legend>Diagnostics</legend>
          <div class="btn-wrap">
            <button class="btn" id="runTests">Run self-test</button>
          </div>
          <ul class="list" id="diagOut" style="max-height: 120px"></ul>
        </fieldset>
      </aside>

      <main>
        <canvas id="viewport"></canvas>
      </main>
    </div>

    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

    <script type="module" src="gen_main.js"></script>
  </body>
</html>
